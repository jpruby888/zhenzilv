"use strict";var e=require("../../common/vendor.js"),o=require("../../utils/commonUtils.js");if(!Array){e.resolveComponent("loginWindow")()}Math;const l={__name:"index",setup(l){const a=e.ref(0),n=e.ref({}),s=e.ref(""),u=e.ref(!1);let t=!1;const c=e=>{console.log(e),u.value=e.showLogin,n.value=e.user,s.value=e.token,i()},r=async e=>{if(!s.value&&!n.value)return u.value=!0;const l={openid:n.value._id,add:e},t=await o.callCloudFunction("zhenzilv","createRecords",l).catch((e=>{console.log(e),o.showModel("请求失败","请重试哦~")}));console.log("sss",t),a.value+=e,a.value<0&&(a.value=0)},i=async()=>{const l={openid:n.value?n.value._id:""},s=await o.callCloudFunction("zhenzilv","getCurrentMark",l).catch((e=>{console.log(e),o.showModel("请求失败","请重试哦~")}));console.log("后端传过来的信息",s),a.value=s.result.mark,t&&(t=!1,e.index.stopPullDownRefresh())},v=()=>{const o=JSON.parse(e.index.getStorageSync("user")||null),l=e.index.getStorageSync("token")||"";n.value=o,s.value=l},d=()=>{e.index.showModal({content:"确定要清零吗？",success(e){e.confirm&&h()}})},h=async()=>{if(0===a.value)return;const e={openid:n.value?n.value._id:""},l=await o.callCloudFunction("zhenzilv","resetMark",e).catch((e=>{console.log(e),o.showModel("请求失败","请重试哦~")}));console.log("清零程序从后端传递过来的信息",l),a.value=0},g=async()=>{if(0===a.value)return;const e={openid:n.value?n.value._id:""},l=await o.callCloudFunction("zhenzilv","deleteRecord",e).catch((e=>{console.log(e),o.showModel("请求失败","请重试哦~")}));console.log("撤销程序从后端传递过来的信息",l),a.value=l.result.mark,o.showSuccess("撤销成功")};return e.onLoad((e=>{v(),!s.value||n.value})),e.onShow((()=>{i(),s.value&&n.value||v()})),e.onPullDownRefresh((()=>{t=!0,i()})),e.onShareAppMessage((()=>({title:"真自律",path:"/pages/index/index"}))),(o,l)=>e.e({a:u.value},u.value?{b:e.o(c)}:{},{c:e.o(d),d:e.o(g),e:e.t(a.value),f:e.o((e=>r(1))),g:e.o((e=>r(-1))),h:e.o((e=>r(5))),i:e.o((e=>r(-5)))})}};var a=e._export_sfc(l,[["__scopeId","data-v-56e25b19"]]);l.__runtimeHooks=2,wx.createPage(a);
